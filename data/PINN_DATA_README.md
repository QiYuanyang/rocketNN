# PINN Trajectory Dataset Format

## Overview

This dataset contains time-series rocket trajectories generated by RocketPy for training the Soft Physics-Informed Neural Network (Soft-PINN).

## Data Generation

Generate data using:
```bash
python src/generate_pinn_data.py <num_simulations> <points_per_trajectory>

# Example: Generate 100 trajectories with 100 time points each
python src/generate_pinn_data.py 100 100

# Example: Generate 5000 trajectories for full training
python src/generate_pinn_data.py 5000 100
```

## Directory Structure

```
data/pinn_trajectories/
├── metadata.json              # Dataset metadata and parameter ranges
├── index.json                 # List of all trajectory files
├── normalization_stats.json   # Mean/std for data normalization (auto-generated)
├── trajectory_00000.json      # Individual trajectory data
├── trajectory_00001.json
├── ...
└── trajectory_NNNNN.json
```

## File Formats

### metadata.json
Contains information about the dataset:
```json
{
  "num_trajectories": 5000,
  "points_per_trajectory": 100,
  "parameter_ranges": {
    "payload_mass": [2.0, 6.0],
    "motor_impulse_scale": [0.95, 1.05],
    "surface_wind_speed": [0.0, 15.0],
    "wind_direction": [0.0, 360.0],
    "shear_exponent": [0.1, 0.3],
    "launch_inclination": [80.0, 90.0],
    "launch_heading": [0.0, 360.0]
  },
  "rocket_config": {...},
  "environment": {...}
}
```

### trajectory_XXXXX.json
Each trajectory file contains:

```json
{
  "params": {
    "payload_mass": 4.23,
    "motor_impulse_scale": 1.02,
    "launch_inclination": 85.3,
    "launch_heading": 123.4,
    "surface_wind_speed": 8.5,
    "wind_direction": 245.6,
    "shear_exponent": 0.18,
    "wind_u": -7.12,
    "wind_v": -3.45,
    "drift_potential": 10.03
  },
  "time": [0.0, 0.12, 0.24, ..., 12.0],
  "position": {
    "x": [0.0, 1.2, 4.5, ...],
    "y": [0.0, 0.3, 1.2, ...],
    "z": [1400.0, 1402.3, 1408.9, ...]
  },
  "velocity": {
    "vx": [0.0, 5.2, 12.3, ...],
    "vy": [0.0, 1.1, 3.4, ...],
    "vz": [0.0, 15.6, 42.1, ...]
  },
  "acceleration": {
    "ax": [2.3, 4.5, 3.2, ...],
    "ay": [0.5, 0.8, 0.6, ...],
    "az": [25.4, 28.1, 22.3, ...]
  },
  "summary": {
    "apogee": 3456.7,
    "apogee_time": 8.3,
    "landing_x": 1234.5,
    "landing_y": 567.8,
    "flight_time": 12.0,
    "max_velocity": 234.5
  }
}
```

## Data Fields

### Input Parameters (10D)
- `payload_mass`: Payload mass in kg [2.0, 6.0]
- `motor_impulse_scale`: Motor thrust scaling factor [0.95, 1.05]
- `launch_inclination`: Launch rail angle from vertical in degrees [80, 90]
- `launch_heading`: Compass heading in degrees [0, 360]
- `surface_wind_speed`: Surface wind speed in m/s [0, 15]
- `wind_direction`: Wind direction in degrees [0, 360]
- `shear_exponent`: Power law wind shear exponent [0.1, 0.3]
- `wind_u`: East wind component in m/s (computed)
- `wind_v`: North wind component in m/s (computed)
- `drift_potential`: Combined wind drift metric (computed)

### Time-Series Outputs
- `time`: Array of time points in seconds (length: N)
- `position`: [x, y, z] coordinates in meters (N×3)
  - x: East direction
  - y: North direction
  - z: Altitude above sea level
- `velocity`: [vx, vy, vz] components in m/s (N×3)
- `acceleration`: [ax, ay, az] components in m/s² (N×3)

### Summary Metrics
- `apogee`: Maximum altitude in meters
- `apogee_time`: Time to reach apogee in seconds
- `landing_x`: Final x position in meters
- `landing_y`: Final y position in meters
- `flight_time`: Total flight time in seconds
- `max_velocity`: Maximum velocity magnitude in m/s

## Loading Data

Use the provided data loader:

```python
from pinn_data_loader import TrajectoryDataset, create_data_loaders

# Load dataset
dataset = TrajectoryDataset(
    data_dir='data/pinn_trajectories',
    normalize=True  # Recommended
)

# Create train/val/test loaders
train_loader, val_loader, test_loader, dataset = create_data_loaders(
    data_dir='data/pinn_trajectories',
    batch_size=32,
    train_split=0.7,
    val_split=0.15,
    normalize=True
)

# Iterate over batches
for batch in train_loader:
    params = batch['params']        # (batch_size, 10)
    time = batch['time']            # (batch_size, 100)
    position = batch['position']    # (batch_size, 100, 3)
    velocity = batch['velocity']    # (batch_size, 100, 3)
    acceleration = batch['acceleration']  # (batch_size, 100, 3)
    # ... training code ...
```

## Data Statistics

After generation, normalization statistics are computed and saved to `normalization_stats.json`. These include:
- Mean and std for each parameter
- Mean and std for time, position, velocity, acceleration

The data loader automatically applies these normalizations when `normalize=True`.

## Physics Constraints

The trajectories satisfy:
1. **Kinematic consistency**: dr/dt = v (within numerical integration error)
2. **Dynamic consistency**: m·dv/dt = F_total (encoded in acceleration)
3. **Initial conditions**: Launch from rail at specified inclination/heading
4. **Boundary conditions**: Simulation runs from launch (t=0) to apogee

## Recommendations

### For Development/Testing
```bash
python src/generate_pinn_data.py 100 100
```
- 100 trajectories × 100 points = 10,000 samples
- Quick generation (~5-10 minutes)
- Good for testing training pipeline

### For Full Training
```bash
python src/generate_pinn_data.py 5000 100
```
- 5,000 trajectories × 100 points = 500,000 samples
- Takes ~3-4 hours to generate
- Recommended for publication-quality results

### For Large-Scale Analysis
```bash
python src/generate_pinn_data.py 10000 100
```
- 10,000 trajectories × 100 points = 1,000,000 samples
- Takes ~6-8 hours to generate
- Best results but diminishing returns beyond 5k

## Storage Requirements

- Each trajectory file: ~15-20 KB
- 100 trajectories: ~2 MB
- 1,000 trajectories: ~20 MB
- 5,000 trajectories: ~100 MB
- 10,000 trajectories: ~200 MB

## Validation

Test the data generation and loading:

```bash
# Generate small test dataset
python src/generate_pinn_data.py 10 50

# Test data loader
python src/pinn_data_loader.py
```

You should see:
```
✓ Data generation complete
✓ Data loader test successful!
```
